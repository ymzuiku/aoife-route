var P=Object.create,b=Object.defineProperty,U=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty,I=Object.getOwnPropertyNames,L=Object.getOwnPropertyDescriptor;var j=e=>b(e,"__esModule",{value:!0});var F=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports);var O=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of I(t))!x.call(e,s)&&s!=="default"&&b(e,s,{get:()=>t[s],enumerable:!(r=L(t,s))||r.enumerable});return e},W=e=>O(j(b(e!=null?P(U(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var _=F((w,T)=>{(function(e,t){typeof w=="object"&&typeof T!="undefined"?t(w):typeof define=="function"&&define.amd?define(["exports"],t):t((e=e||self).queryString={})})(w,function(e){"use strict";function t(o){try{return decodeURIComponent(o.replace(/\+/g," "))}catch(a){return null}}function r(o){try{return encodeURIComponent(o)}catch(a){return null}}function s(o,a){if(!o)return null;for(var n,i=/([^=?&]+)=?([^&]*)/g,f={};n=i.exec(o);){var u=t(n[1]),d=t(n[2]);if(!(u===null||d===null||u in f))if(a||typeof d!="string")f[u]=d;else{var v=Number(d),R=isNaN(v)?d:v;f[u]=d==R.toString()?R:d}}return f}function p(o,a){a===void 0&&(a="");var n,i,f=[];for(i in typeof a!="string"&&(a="?"),o)if(Object.prototype.hasOwnProperty.call(o,i)){if((n=o[i])||n!=null&&!isNaN(n)||(n=""),i=encodeURIComponent(i),n=encodeURIComponent(n),i===null||n===null)continue;f.push(i+"="+n)}return f.length?a+f.join("&"):""}var g={parse:s,stringify:p,decode:t,encode:r};e.decode=t,e.default=g,e.encode=r,e.parse=s,e.stringify=p,Object.defineProperty(e,"__esModule",{value:!0})})});var y=W(_()),k=navigator.userAgent.toLocaleLowerCase(),M=/(?:iphone)/.test(k),$=/micromessenger/.test(k),h={},A=[];["popstate","pushState","replaceState","backState"].forEach(e=>{window.addEventListener(e,()=>{c.state=y.default.parse(location.search),A.forEach(t=>t()),(e==="popstate"||e==="backState")&&delete h[C],e==="popstate"&&l.pop()})});function S(e){let t=document.createElement("span");return t.style.display="none",t.setAttribute("aoife-route",e),t}var q=0,m=!1,C="",l=[],E={},c=({url:e,render:t,preload:r,cache:s})=>{if(typeof t!="function")throw"AoifeRoute.render need a Function";!r&&typeof e=="string"&&(E[e]=t),q+=1;let p=""+q,g=()=>{if(r){let n=typeof r=="number"?r:50;setTimeout(()=>{t()},n)}if(typeof e=="function"){if(!e())return S(p)}else if(y.default.decode(window.location.pathname)!==e)return S(p);if(typeof e=="string"&&h[e]){let n=h[e],i=window.aoife;return i&&i.waitAppend(n).then(()=>{i.next(n)}),n}let o=s&&!m&&typeof e=="string";m=!1;let a=t();if(a.then){let n=S(p);return Promise.resolve(a).then(i=>{if(i.default){let f=document.querySelector(`[aoife-route="${p}"]`);if(!f)return;let u=i.default();u.setAttribute("aoife-route",p),o&&(h[e]=u),f.replaceWith(u)}}),n}return a.setAttribute("aoife-route",p),o&&(h[e]=a),a};return A.push(()=>{let o=document.querySelector(`[aoife-route="${p}"]`);!o||o.replaceWith(g())}),g()};c.onlyReplace=$&&M;c.preload=e=>{let t=E[e];typeof t=="function"&&(t(),E[e]=!0)};c.state={};c.queryString=y.default;c.push=(e,t,{ignoreScrollTop:r,ignoreCache:s}={})=>{if(c.onlyReplace){c.replace(e,t,{ignoreCache:s,ignoreScrollTop:r});return}l.push({state:t,url:e}),t&&(e+="?"+y.default.stringify(t)),r||window.scrollTo&&window.scrollTo({top:0}),setTimeout(()=>{s&&(m=!0),history.pushState(t,"",e),window.dispatchEvent(new Event("pushState"))})};c.replace=(e,t,{ignoreScrollTop:r,ignoreCache:s}={})=>{l.push({state:t,url:e}),t&&(e+="?"+y.default.stringify(t)),r||window.scrollTo&&window.scrollTo({top:0}),setTimeout(()=>{s&&(m=!0),history.replaceState(t,"",e),window.dispatchEvent(new Event("replaceState"))})};var H=()=>{if(C=location.pathname,l.length===0){history.replaceState({},"","/"),window.dispatchEvent(new Event("backState"));return}if(c.onlyReplace){if(l.pop(),l.length===0)history.replaceState({},"","/");else{let{state:e,url:t}=l[l.length-1];history.replaceState(e,"",t)}window.dispatchEvent(new Event("backState"));return}history.back()},N=(e=1,t)=>{if(e<=0){t&&setTimeout(()=>{t()});return}e-=1,H(),setTimeout(()=>{N(e,t)})};c.back=(e=1)=>new Promise(t=>{N(e,t)});c.rootURL="/";var z=c;export{z as default};
