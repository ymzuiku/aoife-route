!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("querystring-number")):"function"==typeof define&&define.amd?define(["querystring-number"],t):(e=e||self).Route=t(e.queryString)}(this,function(f){"use strict";f=f&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f;var e=navigator.userAgent.toLocaleLowerCase(),t=/(?:iphone)/.test(e),e=/micromessenger/.test(e),l={},n=[];function p(e){var t=document.createElement("span");return t.style.display="none",t.setAttribute("aoife-route",e),t}["popstate","pushState","replaceState","backState"].forEach(function(e){window.addEventListener(e,function(){a.state=f.parse(location.search),n.forEach(function(e){return e()}),"popstate"!==e&&"backState"!==e||delete l[r]})});var o=0,d=!1,r="",i=[],h={},a=function(e){var i=e.url,a=e.render,u=e.preload,c=e.cache;if("function"!=typeof a)throw"AoifeRoute.render need a Function";u||"string"!=typeof i||(h[i]=a);function t(){if(u&&setTimeout(function(){a()},"number"==typeof u?u:50),"function"==typeof i){if(!i())return p(s)}else if(f.decode(window.location.pathname)!==i)return p(s);if("string"==typeof i&&l[i]){var e=l[i],t=window.aoife;return t&&t.waitAppend(e).then(function(){t.next(e)}),e}var n=c&&!d&&"string"==typeof i;d=!1;var o=a();if(o.then){var r=p(s);return Promise.resolve(o).then(function(e){var t;!e.default||(t=document.querySelector('[aoife-route="'+s+'"]'))&&((e=e.default()).setAttribute("aoife-route",s),n&&(l[i]=e),t.replaceWith(e))}),r}return o.setAttribute("aoife-route",s),n&&(l[i]=o),o}var s=""+(o+=1);return n.push(function(){var e=document.querySelector('[aoife-route="'+s+'"]');e&&e.replaceWith(t())}),t()};a.onlyReplace=e&&t,a.preload=function(e){var t=h[e];"function"==typeof t&&(t(),h[e]=!0)},a.state={},a.queryString=f,a.push=function(e,t,n){var o=void 0===n?{}:n,n=o.ignoreScrollTop,r=o.ignoreCache;a.onlyReplace?a.replace(e,t,{ignoreCache:r,ignoreScrollTop:n}):(i.push({state:t,url:e}),t&&(e+="?"+f.stringify(t)),n||window.scrollTo&&window.scrollTo({top:0}),setTimeout(function(){r&&(d=!0),history.pushState(t,"",e),window.dispatchEvent(new Event("pushState"))}))},a.replace=function(e,t,n){var o=void 0===n?{}:n,n=o.ignoreScrollTop,r=o.ignoreCache;i.push({state:t,url:e}),t&&(e+="?"+f.stringify(t)),n||window.scrollTo&&window.scrollTo({top:0}),setTimeout(function(){r&&(d=!0),history.replaceState(t,"",e),window.dispatchEvent(new Event("replaceState"))})};var u=function(e,t){var n,o;(e=void 0===e?1:e)<=0?t&&setTimeout(function(){t()}):(--e,r=location.pathname,0===i.length?(history.replaceState({},"","/"),window.dispatchEvent(new Event("backState"))):a.onlyReplace?(i.pop(),0===i.length?history.replaceState({},"","/"):(n=(o=i[i.length-1]).state,o=o.url,history.replaceState(n,"",o)),window.dispatchEvent(new Event("backState"))):history.back(),setTimeout(function(){u(e,t)}))};return a.back=function(t){return void 0===t&&(t=1),new Promise(function(e){u(t,e)})},a.rootURL="/",a});
//# sourceMappingURL=index.js.map
