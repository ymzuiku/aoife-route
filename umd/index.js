!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("querystring-number")):"function"==typeof define&&define.amd?define(["querystring-number"],t):(e=e||self).Route=t(e.queryString)}(this,function(c){"use strict";c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c;var i=/MicroMessenger/.test(navigator.userAgent),s={},o=[];function p(e){var t=document.createElement("span");return t.style.display="none",t.setAttribute("aoife-route",e),t}["popstate","pushState","replaceState","backState"].forEach(function(e){window.addEventListener(e,function(){u.state=c.parse(location.search),o.forEach(function(e){return e()}),"popstate"!==e&&"backState"!==e||delete s[r],"popstate"===e&&a.pop()})});var l=0,f=!1,r="",a=[],u=function(e){var r=e.url,n=e.render,i=e.preload,a=e.cache;if("function"!=typeof n)throw"AoifeRoute.render need a Function";function t(){if(i&&n(),"function"==typeof r){if(!r())return p(u)}else if(c.decode(window.location.pathname)!==r)return p(u);if("string"==typeof r&&s[r])return s[r];var o=a&&!f&&"string"==typeof r;f=!1;var e=n();if(e.then){var t=p(u);return Promise.resolve(e).then(function(e){var t;!e.default||(t=document.querySelector('[aoife-route="'+u+'"]'))&&((e=e.default()).setAttribute("aoife-route",u),o&&(s[r]=e),t.replaceWith(e))}),t}return e.setAttribute("aoife-route",u),o&&(s[r]=e),e}var u=""+(l+=1);return o.push(function(){var e=document.querySelector('[aoife-route="'+u+'"]');e&&e.replaceWith(t())}),t()};return u.state={},u.queryString=c,u.push=function(e,t,o){var r=void 0===o?{}:o,o=r.ignoreScrollTop,n=r.ignoreCache;i?u.replace(e,t,{ignoreCache:n,ignoreScrollTop:o}):(a.push({state:t,url:e}),t&&(e+="?"+c.stringify(t)),o||window.scrollTo&&window.scrollTo({top:0}),setTimeout(function(){n&&(f=!0),history.pushState(t,"",e),window.dispatchEvent(new Event("pushState"))}))},u.replace=function(e,t,o){var r=void 0===o?{}:o,o=r.ignoreScrollTop,n=r.ignoreCache;a.push({state:t,url:e}),t&&(e+="?"+c.stringify(t)),o||window.scrollTo&&window.scrollTo({top:0}),setTimeout(function(){n&&(f=!0),history.replaceState(t,"",e),window.dispatchEvent(new Event("replaceState"))})},u.back=function(){return r=location.pathname,0===a.length?(history.replaceState({},"","/"),void window.dispatchEvent(new Event("backState"))):i?(a.pop(),0===a.length?history.replaceState({},"","/"):(e=(t=a[a.length-1]).state,t=t.url,history.replaceState(e,"",t)),void window.dispatchEvent(new Event("backState"))):void history.back();var e,t},u});
//# sourceMappingURL=index.js.map
